from scipy.stats import chi2, norm, truncnorm

INITIAL_AMOUNT_MEAN = 114_000_000
INITIAL_AMOUNT_STD = 46_000_000

SESSION_DURATION_DF = 0.35972655966338585
SESSION_DURATION_LOC = -2.300976377445386e-20
SESSION_DURATION_SCALE = 77_340.09006918102

CONSUMPTION_RATE_DF = 0.24594936612371615
CONSUMPTION_RATE_LOC = 0.003888888888888884
CONSUMPTION_RATE_SCALE = 536_750.7673112341

SESSION_INTERVAL_DF = 0.4399814175248422
SESSION_INTERVAL_LOC = 0.9999999999999999
SESSION_INTERVAL_SCALE = 37_555.10868230616

MIN_AMOUNT_BEFORE_TOP_UP_MEAN = 17_000_000
MIN_AMOUNT_BEFORE_TOP_UP_STD = 32_000_000

TOP_UP_AMOUNT_MEAN = 124_000_000
TOP_UP_AMOUNT_STD = 82_000_000

ZERO_AMOUNT_TOP_UP_DELAY_MEAN = 28_777
ZERO_AMOUNT_TOP_UP_DELAY_STD = 258_912

CTG_THRESHOLD_PERCENTAGE = 0.3
CTG_QUOTA_BLOCK_SIZE = 0.1
CTG_MIN_QUOTA = 10_485_760 * 10

LOSSES_VOLUME_MIN_MULTIPLIER = 2
LOSSES_VOLUME_MAX_MULTIPLIER = 10
LOSSES_VOLUME_MEAN = 6
LOSSES_VOLUME_STD = 1.5
LOSSES_OCCURRENCE_PERCENTAGE = 0.02

INITIAL_THRESHOLD = 50_000_000  # 3_221_225_472
NUMBER_OF_SESSIONS = 10_000
GRANTED_QUOTA_CNT = 104_857_600
GRANTED_STATE_UNIT = 104_857_600
REPORTS_FOLDER = "reports"
URL = "http://127.0.0.1:5000/sac_interface"
USE_FIXED_THRESHOLD = True


def get_initial_amount():
    return abs(norm(loc=INITIAL_AMOUNT_MEAN, scale=INITIAL_AMOUNT_STD).rvs())


def get_session_duration():
    return chi2.rvs(df=SESSION_DURATION_DF,
                    loc=SESSION_DURATION_LOC,
                    scale=SESSION_DURATION_SCALE)


def get_consumption_rate():
    return chi2.rvs(df=CONSUMPTION_RATE_DF,
                    loc=CONSUMPTION_RATE_LOC,
                    scale=CONSUMPTION_RATE_SCALE)


def get_min_amount_before_top_up():
    return norm(loc=MIN_AMOUNT_BEFORE_TOP_UP_MEAN, scale=MIN_AMOUNT_BEFORE_TOP_UP_STD).rvs()


def get_top_up_amount():
    return abs(norm(loc=TOP_UP_AMOUNT_MEAN, scale=TOP_UP_AMOUNT_STD).rvs())


def get_zero_amount_top_up_delay():
    return abs(norm(loc=ZERO_AMOUNT_TOP_UP_DELAY_MEAN, scale=ZERO_AMOUNT_TOP_UP_DELAY_STD).rvs())


def get_loss_volume_multiplier():
    a = (LOSSES_VOLUME_MIN_MULTIPLIER - LOSSES_VOLUME_MEAN) / LOSSES_VOLUME_STD
    b = (LOSSES_VOLUME_MAX_MULTIPLIER - LOSSES_VOLUME_MEAN) / LOSSES_VOLUME_STD

    return truncnorm(a, b, LOSSES_VOLUME_MEAN, LOSSES_VOLUME_STD).rvs()


if __name__ == '__main__':
    print(get_loss_volume_multiplier())
